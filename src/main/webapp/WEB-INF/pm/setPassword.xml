<?xml version="1.0" encoding="UTF-8"?>
<flow parent="common" 
      xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">
  
  <!-- This webflow is for user's who change their passwords immediately after they have authenticated.
        There 2 ways to get to this flow are a forced change, immediately after the login, and an 
        optional change from the warning on the messages page, which shows immediately after login.
        
        It is also used in the forgot password flow.  After the user passes the captcha and security questions,
        They are sent here to set a new password.
        
        The username cannot be changed on the log-in form.  The old password is not required at this
        time because they just entered it correctly.  We might decide to require it in the future. -->

  <input name="username" type="java.lang.String" required="true" />
    
  <view-state id="setPassword" view="casPmChangePassword" model="changePasswordBean">
    <var name="setPasswordBean" class="net.unicon.cas.passwordmanager.flow.model.ChangePasswordBean" />
    <!--        <on-render>
        <set name="forced" value="forced">
    </on-render>-->
    <binder>
      <binding property="newPassword"/>
      <binding property="confirmNewPassword"/>
    </binder>
    <transition on="submitChangePassword" to="passwordSet">
      <evaluate expression="processChangePasswordAction.setPassword(flowScope.username,
                setPasswordBean.newPassword, messageContext)" />
    </transition>
  </view-state>
    
  <view-state id="passwordChanged" view="casPmChangedPassword">
    <transition to="pmExit" />
  </view-state>
    
  <view-state id="passwordSet" view="casPmSetPassword">
    <transition to="pmExit" />
  </view-state>
</flow>

